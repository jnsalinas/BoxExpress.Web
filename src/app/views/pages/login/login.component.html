<app-loading-overlay
  *ngIf="isLoading"
  [loadingText]="'Cargando...'"
></app-loading-overlay>
<div
  class="bg-light dark:bg-transparent min-vh-100 d-flex flex-row align-items-center"
>
  <c-container breakpoint="md">
    <c-row class="justify-content-center">
      <c-col lg="10" xl="8">
        <c-card-group>
          <c-card class="p-4">
            <c-card-body>
              <form [formGroup]="loginForm" (ngSubmit)="login()">
                <h1>Inicio de Sesión</h1>
                <p class="text-body-secondary">Ingresa con tu cuenta</p>

                <c-input-group class="mb-3">
                  <span cInputGroupText>
                    <svg cIcon name="cilUser"></svg>
                  </span>
                  <div class="form-group">
                    <input
                      formControlName="username"
                      type="text"
                      [ngClass]="{
                        'input-error':
                          loginForm.get('username')?.invalid &&
                          loginForm.get('username')?.touched
                      }"
                      class="form-control"
                      placeholder="Usuario"
                    />
                    <div *ngIf="loginForm.get('username')?.touched">
                      <div
                        *ngIf="loginForm.get('username')?.errors?.['required']"
                        class="my-error-message"
                      >
                        Este campo es obligatorio.
                      </div>
                      <div
                        *ngIf="!loginForm.get('username')?.errors?.['required'] && loginForm.get('username')?.errors?.['email']"
                        class="my-error-message"
                      >
                        Ingresa un correo válido.
                      </div>
                    </div>
                  </div>
                </c-input-group>

                <!-- Campo Contraseña -->
                <c-input-group class="mb-4">
                  <span cInputGroupText>
                    <svg cIcon name="cilLockLocked"></svg>
                  </span>

                  <div class="form-group position-relative">
                    <input
                      formControlName="password"
                      [type]="showPassword ? 'text' : 'password'"
                      [ngClass]="{
                        'input-error':
                          loginForm.get('password')?.invalid &&
                          loginForm.get('password')?.touched
                      }"
                      class="form-control"
                      placeholder="Contraseña"
                    />

                    <!-- Botón ojito -->
                    <button
                      type="button"
                      class="btn btn-sm position-absolute end-0 me-2 bg-transparent border-0"
                      (click)="togglePasswordVisibility()"
                      style="top: 50%; transform: translateY(-50%)"
                    >
                      <img
                        *ngIf="!showPassword"
                        src="assets/eye-solid.svg"
                        alt="Mostrar contraseña"
                        width="20"
                        height="20"
                      />
                      <img
                        *ngIf="showPassword"
                        src="assets/eye-slash-solid.svg"
                        alt="Ocultar contraseña"
                        width="20"
                        height="20"
                      />
                    </button>

                    <!-- Validaciones -->
                    <div *ngIf="loginForm.get('password')?.touched">
                      <div
                        *ngIf="loginForm.get('password')?.errors?.['required']"
                        class="my-error-message"
                      >
                        Este campo es obligatorio.
                      </div>
                      <div
                        *ngIf="!loginForm.get('password')?.errors?.['required'] &&
               loginForm.get('password')?.errors?.['pattern']"
                        class="my-error-message"
                      >
                        Debe incluir una mayúscula y un número.
                      </div>
                    </div>
                  </div>
                </c-input-group>

                <c-row>
                  <c-col xs="6">
                    <button cButton class="px-4" color="primary" type="submit">
                      Ingresar
                    </button>
                  </c-col>
                </c-row>
              </form>
            </c-card-body>
          </c-card>

          <c-card
            [ngStyle]="{ 'minWidth.%': 44 }"
            class="bg-primary overflow-hidden p-0"
          >
            <div
              class="position-relative h-100 w-100"
              style="padding: 0.5px; box-sizing: border-box"
            >
              <img
                src="assets/images/BoxExpressBlackLogo.png"
                alt="Logo"
                class="w-100 h-100 position-absolute"
                style="object-fit: cover; box-sizing: border-box"
              />
              <div
                class="d-flex flex-column justify-content-end align-items-center position-absolute w-100 h-100"
              >
                <button
                  [routerLink]="['/register']"
                  cButton
                  color="primary"
                  style="background-color: black"
                  class="px-4 mb-4"
                  type="button"
                >
                  Registrar
                </button>
              </div>
            </div>
          </c-card>
        </c-card-group>
      </c-col>
    </c-row>
  </c-container>
</div>
