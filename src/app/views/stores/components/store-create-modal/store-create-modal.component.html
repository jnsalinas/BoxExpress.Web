<c-modal
  [visible]="storeId !== null"
  size="lg"
  backdrop="static"
  class="modern-modal"
>
  <c-modal-header class="modal-header-custom">
    <h5 class="modal-title">
      <div class="d-flex align-items-center">
        <div class="modal-icon me-2">
          <i class="fas fa-store text-primary"></i>
        </div>
        <div>
          <span class="fw-bold">Editar tienda</span>
        </div>
      </div>
    </h5>
  </c-modal-header>

  <c-modal-body class="modal-body-custom">
    <div class="alert alert-success" role="alert">
      <div class="d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center">
          <i class="fas fa-info-circle me-2"></i>
          <span class="fw-semibold">Integración con Shopify</span>
        </div>
        <button
          type="button"
          class="btn btn-sm btn-light"
          (click)="copyLink()"
          [disabled]="!store?.id"
        >
          <i class="fas" [ngClass]="copied ? 'fa-check' : 'fa-copy'"></i>
          <span class="ms-1">{{ copied ? "Copiado" : "Copiar" }}</span>
        </button>
      </div>
      <div class="small text-break font-monospace mt-2">{{ computedUrl }}</div>
    </div>
    <form [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>
      <div class="row g-3">
        <div class="col-md-6">
          <label for="name" class="form-label">
            <i class="fas fa-tag me-1 text-muted"></i>
            Nombre <span class="text-danger">*</span>
          </label>
          <input
            type="text"
            id="name"
            class="form-control"
            formControlName="name"
            placeholder="Ingrese el nombre de la tienda"
            [class.is-invalid]="
              form.get('name')?.invalid &&
              (form.get('name')?.touched || submitted)
            "
          />
          <div
            *ngIf="
              form.get('name')?.invalid &&
              (form.get('name')?.touched || submitted)
            "
            class="invalid-feedback d-block"
          >
            <span *ngIf="form.get('name')?.errors?.['required']"
              >El nombre es obligatorio.</span
            >
            <span *ngIf="form.get('name')?.errors?.['minlength']"
              >El nombre debe tener al menos 3 caracteres.</span
            >
          </div>
        </div>

        <div class="col-md-6" *hasRole="['admin']">
          <label for="deliveryFee" class="form-label">
            <i class="fas fa-link me-1 text-muted"></i>
            Flete
          </label>
          <input
            type="number"
            id="deliveryFee"
            class="form-control"
            formControlName="deliveryFee"
          />
        </div>
      </div>
      <div class="row g-3">
        <div class="col-md-6">
          <label for="username" class="form-label">
            <i class="fas fa-user me-1 text-muted"></i>
            Usuario
          </label>
          <input
            type="text"
            id="username"
            class="form-control"
            formControlName="username"
            placeholder="Ingrese el nombre de usuario"
          />
        </div>

        <div class="col-md-6">
          <label for="password" class="form-label">
            <i class="fas fa-lock me-1 text-muted"></i>
            Contraseña
          </label>
          <div class="position-relative">
            <input
              [type]="showPassword ? 'text' : 'password'"
              id="password"
              class="form-control"
              formControlName="password"
              placeholder="Ingrese la contraseña"
            />
            <div
              *ngIf="form.get('password')?.invalid && (form.get('password')?.touched || submitted)"
              class="invalid-feedback d-block"
            >
              <span *ngIf="form.get('password')?.errors?.['required']">
                La contraseña es obligatoria.
              </span>
              <span *ngIf="form.get('password')?.errors?.['passwordPattern']">
                Debe tener al menos 8 caracteres, 1 mayúscula y 1 número.
              </span>
            </div>
            <button
              type="button"
              class="btn btn-sm position-absolute end-0 top-50 translate-middle-y me-2"
              (click)="togglePasswordVisibility()"
              tabindex="-1"
            >
              <img
                *ngIf="!showPassword"
                src="assets/eye-solid.svg"
                alt="Mostrar contraseña"
                width="16"
                height="16"
              />
              <img
                *ngIf="showPassword"
                src="assets/eye-slash-solid.svg"
                alt="Ocultar contraseña"
                width="16"
                height="16"
              />
            </button>
          </div>
        </div>
      </div>
    </form>
  </c-modal-body>

  <c-modal-footer class="modal-footer-custom">
    <div class="d-flex gap-2 w-100">
      <button
        type="button"
        class="btn btn-outline-secondary flex-fill"
        (click)="onClose()"
        [disabled]="isLoading"
      >
        <i class="fas fa-times me-1"></i>
        Cancelar
      </button>
      <button
        type="button"
        class="btn btn-primary flex-fill"
        (click)="onSubmit()"
        [disabled]="form.invalid || isLoading"
      >
        <span
          *ngIf="isLoading"
          class="spinner-border spinner-border-sm me-2"
        ></span>
        <i class="fas fa-save me-1" *ngIf="!isLoading"></i>
        Guardar cambios
      </button>
    </div>
  </c-modal-footer>
</c-modal>
