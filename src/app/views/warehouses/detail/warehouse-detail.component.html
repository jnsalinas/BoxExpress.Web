<c-row>
  <c-col xs="12">
    <c-card class="mb-3">
      <c-card-header>
        <strong>Bodega:</strong> {{ warehouseDetail?.name }}
        <div class="d-flex justify-content-end gap-2">
          <button class="btn btn-sm btn-primary" (click)="openInventoryModal()">
            Agregar productos
          </button>
          <button class="btn btn-sm btn-primary" (click)="openTransferModal()">
            Transferir productos
          </button>
        </div>
      </c-card-header>
      <c-card-body>
        <div class="input-group mb-3">
          <span class="input-group-text">üîç</span>
          <input
            type="text"
            class="form-control"
            placeholder="Buscar producto"
            [(ngModel)]="searchTerm"
            (input)="filterProducts()"
          />
          <button class="btn btn-outline-secondary" (click)="clearSearch()">
            Limpiar
          </button>
        </div>

        <table cTable>
          <thead>
            <tr>
              <th>Producto</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let product of filteredProducts">
              <td colspan="2">
                <div class="p-3 mb-3 border rounded bg-white shadow-sm">
                  <!-- Encabezado del producto -->
                  <div
                    class="d-flex justify-content-between align-items-center mb-2"
                  >
                    <div>
                      <h5 class="mb-0">{{ product.name }}</h5>
                      <span class="badge bg-secondary">{{ product.sku }}</span>
                    </div>
                  </div>

                  <!-- Lista de variantes -->
                  <div class="ms-2">
                    <div
                      *ngFor="let variant of product.variants"
                      class="p-2 mb-2 border rounded bg-light"
                    >
                      <div class="d-flex justify-content-between">
                        <div>
                          <strong>{{ variant.name }}</strong> ({{
                            variant.quantity
                          }})
                          <div
                            *ngIf="variant.shopifyId"
                            class="text-muted small"
                          >
                            Shopify ID: {{ variant.shopifyId }}
                          </div>
                          <div *ngIf="variant.sku" class="text-muted small">
                            SKU:
                            <span class="badge bg-secondary">{{
                              variant.sku
                            }}</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </c-card-body>
    </c-card>
  </c-col>
</c-row>

<app-warehouse-product-modal
  *ngIf="warehouseDetail"
  [warehouseId]="warehouseDetail.id"
  [warehouseName]="warehouseDetail.name"
  [isVisible]="isModalInventoryVisible"
  [productToEdit]="productToEdit"
  (onSave)="handleInventorySave($event)"
  (onClose)="handleInventoryClose($event)"
>
</app-warehouse-product-modal>

<app-warehouse-transfer-modal
  *ngIf="warehouseDetail"
  [isVisible]="isModalTransferVisible"
  [warehouseId]="warehouseDetail.id"
  (onSave)="handleTransferSave($event)"
  (onClose)="handleTransferClose($event)"
>
</app-warehouse-transfer-modal>
