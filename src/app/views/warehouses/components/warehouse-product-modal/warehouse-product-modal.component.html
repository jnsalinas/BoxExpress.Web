<c-modal [visible]="true" size="lg" backdrop="static" keyboard="false">
  <c-modal-header>
    <h5 class="modal-title">Agregar producto a {{ warehouseName }}</h5>
  </c-modal-header>

  <c-modal-body>
    <form [formGroup]="productForm">
      <div formArrayName="products">
        <!-- Iterar sobre los productos en el FormArray -->
        <div
          *ngFor="let product of products.controls; let i = index"
          [formGroupName]="i"
        >
          <div class="mb-3 border rounded p-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <button class="btn btn-sm btn-danger" (click)="removeProduct(i)">
                Eliminar Producto
              </button>
            </div>

            <div class="form-group d-flex gap-2 align-items-start flex-wrap">
                <div>
                  <label for="productName">Nombre del producto</label>
                  <input
                    id="productName"
                    type="text"
                    class="form-control mb-2"
                    formControlName="name"
                    placeholder="Nombre del producto"
                  />
                  <div
                    *ngIf="product.get('name')?.invalid && product.get('name')?.touched"
                    class="text-danger"
                  >
                    El nombre del producto es obligatorio
                  </div>
                </div>
              
                <div>
                  <label for="productCode">Código del shopify</label>
                  <input
                    id="productCode"
                    type="text"
                    class="form-control mb-2"
                    placeholder="Código del producto"
                  />
                </div>
              </div>

            <!-- Variantes del Producto -->
            <div formArrayName="variants">
              <div
                *ngFor="let variant of getVariants(i).controls; let j = index"
                [formGroupName]="j"
                class="mb-2 ps-3"
              >
                <div class="input-group">
                  <input
                    class="form-control"
                    [formControlName]="'name'"
                    placeholder="Nombre de variante"
                  />
                  <input
                    class="form-control ms-2"
                    [formControlName]="'quantity'"
                    type="number"
                    placeholder="Cantidad"
                    min="1"
                  />
                  <button
                    class="btn btn-sm btn-outline-danger ms-2"
                    (click)="removeVariant(i, j)"
                  >
                    Eliminar
                  </button>
                </div>
                <div
                  *ngIf="
                    variant.get('name')?.invalid && variant.get('name')?.touched
                  "
                  class="text-danger"
                >
                  El nombre de la variante es obligatorio
                </div>
                <div
                  *ngIf="
                    variant.get('quantity')?.invalid &&
                    variant.get('quantity')?.touched
                  "
                  class="text-danger"
                >
                  La cantidad es obligatoria y debe ser mayor que 0
                </div>
              </div>
            </div>

            <button
              type="button"
              class="btn btn-sm btn-outline-primary mt-2"
              (click)="addVariant(i)"
            >
              + Agregar variante
            </button>
          </div>
        </div>
      </div>

      <button
        type="button"
        class="btn btn-outline-success mt-2"
        (click)="addProduct()"
      >
        + Agregar producto
      </button>
    </form>
  </c-modal-body>

  <c-modal-footer>
    <button class="btn btn-secondary" type="button" (click)="close()">
      Cancelar
    </button>
    <button
      class="btn btn-primary"
      type="submit"
      (click)="save()"
      [disabled]="productForm.invalid"
    >
      Guardar
    </button>
  </c-modal-footer>
</c-modal>
