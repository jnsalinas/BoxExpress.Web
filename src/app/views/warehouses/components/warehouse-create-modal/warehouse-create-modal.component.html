<c-modal [visible]="true" size="lg" backdrop="static" class="modern-modal">
  <c-modal-header class="modal-header-custom">
    <h5 class="modal-title">
      <div class="d-flex align-items-center">
        <div class="modal-icon me-2">
          <svg [cIcon]="icons.cilHome" size="2xl"></svg>
        </div>
        <div>
          <span class="fw-bold">Crear Nueva Bodega</span>
        </div>
      </div>
    </h5>
  </c-modal-header>

  <c-modal-body class="modal-body-custom">
    <form [formGroup]="form" (ngSubmit)="save()" novalidate>
      <div class="row g-3">
        <div class="col-md-6">
          <label for="name" class="form-label">
            <i class="fas fa-building me-1 text-muted"></i>
            Nombre de la Bodega <span class="text-danger">*</span>
          </label>
          <input
            type="text"
            id="name"
            class="form-control"
            formControlName="name"
            placeholder="Ingrese el nombre de la bodega"
            [class.is-invalid]="form.get('name')?.invalid && (form.get('name')?.touched || submitted)"
          />
          <div *ngIf="form.get('name')?.invalid && (form.get('name')?.touched || submitted)" class="invalid-feedback d-block">
            <span *ngIf="form.get('name')?.errors?.['required']">El nombre es obligatorio.</span>
            <span *ngIf="form.get('name')?.errors?.['minlength']">El nombre debe tener al menos 2 caracteres.</span>
          </div>
        </div>

        <div class="col-md-6">
          <label for="cityId" class="form-label">
            <i class="fas fa-map-marker-alt me-1 text-muted"></i>
            Ciudad <span class="text-danger">*</span>
          </label>
          <select
            id="cityId"
            class="form-select"
            formControlName="cityId"
            [class.is-invalid]="form.get('cityId')?.invalid && (form.get('cityId')?.touched || submitted)"
          >
            <option value="">Seleccione una ciudad</option>
            <option *ngFor="let city of cities" [value]="city.id">
              {{ city.name }}
            </option>
          </select>
          <div *ngIf="form.get('cityId')?.invalid && (form.get('cityId')?.touched || submitted)" class="invalid-feedback d-block">
            <span *ngIf="form.get('cityId')?.errors?.['required']">Debe seleccionar una ciudad.</span>
          </div>
        </div>

        <div class="col-12">
          <label for="address" class="form-label">
            <i class="fas fa-map me-1 text-muted"></i>
            Dirección <span class="text-danger">*</span>
          </label>
          <input
            type="text"
            id="address"
            class="form-control"
            formControlName="address"
            placeholder="Ingrese la dirección completa"
            [class.is-invalid]="form.get('address')?.invalid && (form.get('address')?.touched || submitted)"
          />
          <div *ngIf="form.get('address')?.invalid && (form.get('address')?.touched || submitted)" class="invalid-feedback d-block">
            <span *ngIf="form.get('address')?.errors?.['required']">La dirección es obligatoria.</span>
          </div>
        </div>

        <div class="col-12">
          <label for="manager" class="form-label">
            <i class="fas fa-user-tie me-1 text-muted"></i>
            Gerente <span class="text-danger">*</span>
          </label>
          <input
            type="text"
            id="manager"
            class="form-control"
            formControlName="manager"
            placeholder="Ingrese el nombre del gerente"
            [class.is-invalid]="form.get('manager')?.invalid && (form.get('manager')?.touched || submitted)"
          />
          <div *ngIf="form.get('manager')?.invalid && (form.get('manager')?.touched || submitted)" class="invalid-feedback d-block">
            <span *ngIf="form.get('manager')?.errors?.['required']">El gerente es obligatorio.</span>
          </div>
        </div>

        <div class="col-md-6">
          <label for="email" class="form-label">
            <i class="fas fa-envelope me-1 text-muted"></i>
            Email <span class="text-danger">*</span>
          </label>
          <input
            type="email"
            id="email"
            class="form-control"
            formControlName="email"
            placeholder="Ingrese el email del usuario"
            [class.is-invalid]="form.get('email')?.invalid && (form.get('email')?.touched || submitted)"
          />
          <div *ngIf="form.get('email')?.invalid && (form.get('email')?.touched || submitted)" class="invalid-feedback d-block">
            <span *ngIf="form.get('email')?.errors?.['required']">El email es obligatorio.</span>
            <span *ngIf="form.get('email')?.errors?.['email']">Ingrese un email válido.</span>
          </div>
        </div>

        <div class="col-md-6">
          <label for="password" class="form-label">
            <i class="fas fa-lock me-1 text-muted"></i>
            Contraseña <span class="text-danger">*</span>
          </label>
          <div class="position-relative">
            <input
              type="{{ showPassword ? 'text' : 'password' }}"
              id="password"
              class="form-control"
              formControlName="password"
              placeholder="Ingrese la contraseña"
              [class.is-invalid]="form.get('password')?.invalid && (form.get('password')?.touched || submitted)"
            />
            <button
              type="button"
              class="btn btn-sm position-absolute end-0 top-50 translate-middle-y me-2"
              (click)="togglePasswordVisibility()"
              tabindex="-1"
            >
              <img
                *ngIf="!showPassword"
                src="assets/eye-solid.svg"
                alt="Mostrar contraseña"
                width="16"
                height="16"
              />
              <img
                *ngIf="showPassword"
                src="assets/eye-slash-solid.svg"
                alt="Ocultar contraseña"
                width="16"
                height="16"
              />
            </button>
          </div>
          <div *ngIf="form.get('password')?.invalid && (form.get('password')?.touched || submitted)" class="invalid-feedback d-block">
            <span *ngIf="form.get('password')?.errors?.['required']">La contraseña es obligatoria.</span>
          </div>
          <small
            [ngClass]="{
              'form-text text-muted ms-1': !form.get('password')?.errors?.['passwordPattern'] || !(form.get('password')?.touched || submitted),
              'text-danger ms-1': form.get('password')?.errors?.['passwordPattern'] && (form.get('password')?.touched || submitted)
            }"
          >
            <i class="fas fa-info-circle me-1"></i>
            La contraseña debe tener al menos 8 caracteres, una mayúscula y un número.
          </small>
        </div>
      </div>
    </form>
  </c-modal-body>

  <c-modal-footer class="modal-footer-custom">
    <div class="d-flex gap-2 w-100">
      <button type="button" class="btn btn-outline-secondary flex-fill" (click)="close()" [disabled]="isLoading">
        <i class="fas fa-times me-1"></i>
        Cancelar
      </button>
      <button
        type="button"
        class="btn btn-primary flex-fill"
        (click)="save()"
        [disabled]="form.invalid || isLoading"
      >
        <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
        <i class="fas fa-save me-1" *ngIf="!isLoading"></i>
        {{ isLoading ? 'Creando...' : 'Crear Bodega' }}
      </button>
    </div>
  </c-modal-footer>
</c-modal> 