<div class="inventory-table-container">
  <div class="products-grid">
    <div
      *ngFor="let product of products; let productIndex = index"
      class="product-card"
    >
      <!-- Header del producto -->
      <div class="product-card-header">
        <div class="product-info">
          <div class="product-title">
            <i class="fas fa-box me-2 text-primary"></i>
            <strong>{{ product.name }}</strong>
          </div>
          <div class="product-stats">
            <div class="total-quantity">
              <i class="fas fa-calculator me-1"></i>
              <span class="quantity-number">{{ product.totalQuantity }}</span>
              <span class="quantity-label">cantidades totales</span>
            </div>
            <div class="variants-count">
              <i class="fas fa-tags me-1"></i>
              <span
                >{{ product.variants?.length || 0 }} variante{{
                  product.variants?.length !== 1 ? "s" : ""
                }}</span
              >
            </div>
          </div>
        </div>
        <div class="product-actions">
          <button
            type="button"
            *ngIf="actionsTemplate && isAdmin"
            class="btn btn-sm btn-outline-primary"
            (click)="onAddVariant(product)"
          >
            <i class="fas fa-plus me-1"></i>
            Agregar variante
          </button>
        </div>
      </div>

      <!-- Tabla de variantes -->
      <div class="variants-table-container">
        <div class="table-responsive">
          <table class="table table-sm variants-table">
            <thead class="table-light">
              <tr>
                <th class="variant-column">
                  <i class="fas fa-tag me-1"></i>
                  Variante
                </th>
                <th *ngIf="showStore" class="store-column">
                  <i class="fas fa-store me-1"></i>
                  Tienda
                </th>
                <th *ngIf="showStore" class="warehouse-column">
                  <i class="fas fa-warehouse me-1"></i>
                  Bodega
                </th>
                <th class="available-column">
                  <i class="fas fa-check-circle me-1"></i>
                  Disponible
                </th>
                <th class="processing-column">
                  <i class="fas fa-clock me-1"></i>
                  Procesamiento
                </th>
                <th class="delivered-column">
                  <i class="fas fa-truck me-1"></i>
                  Entregado
                </th>
                <th class="return-column">
                  <i class="fas fa-undo me-1"></i>
                  En devoluci√≥n
                </th>
                <th class="total-column">
                  <i class="fas fa-calculator me-1"></i>
                  Total
                </th>
                <th class="sku-column">
                  <i class="fas fa-barcode me-1"></i>
                  SKU
                </th>
                <th *ngIf="showActions" class="actions-column">
                  <i class="fas fa-cogs me-1"></i>
                  Acciones
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let variant of product.variants" class="variant-row">
                <td class="variant-cell">
                  <strong>{{ variant.name }}</strong>
                </td>
                <td *ngIf="showStore" class="store-cell">
                  {{ variant.store?.name || "-" }}
                </td>
                <td *ngIf="showStore" class="warehouse-cell">
                  {{ variant.warehouseName || "-" }}
                </td>
                <td class="available-cell">
                  <span class="badge bg-success">{{
                    variant.availableQuantity || 0
                  }}</span>
                </td>
                <td class="processing-cell">
                  <span class="badge bg-warning">{{
                    variant.reservedQuantity || 0
                  }}</span>
                </td>
                <td class="delivered-cell">
                  <span class="badge bg-info">{{
                    variant.deliveredQuantity || 0
                  }}</span>
                </td>
                <td class="return-cell">
                  <span class="badge bg-danger">{{
                    variant.pendingReturnQuantity || 0
                  }}</span>
                </td>
                <td class="total-cell">
                  <strong>{{ variant.quantity || 0 }}</strong>
                </td>
                <td class="sku-cell">
                  <span *ngIf="variant.sku" class="badge bg-secondary small">
                    {{ variant.sku }}
                  </span>
                  <span *ngIf="!variant.sku" class="text-muted small">-</span>
                </td>
                <td *ngIf="showActions" class="actions-cell">
                  <div class="d-flex gap-1">
                    <!-- <a
                      class="btn btn-sm btn-outline-primary"
                      [routerLink]="[
                        '/warehouses',
                        warehouseDetail?.id,
                        'inventory',
                        variant.warehouseInventoryId
                      ]"
                      title="Ver historial"
                    >
                      <svg
                        [cIcon]="icons.cilHistory"
                        size="sm"
                        class="me-1"
                      ></svg>
                      Ver historial
                    </a> -->
                    <a
                      *hasRole="['admin', 'bodega']"
                      class="btn btn-sm btn-outline-primary"
                      (click)="openInventoryItemModal(variant)"
                      title="Ver historial"
                    >
                      <svg
                        [cIcon]="icons.cilPencil"
                        size="sm"
                        class="me-1"
                      ></svg>
                      Editar
                    </a>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <app-generic-pagination
    *ngIf="pagination"
    [pagination]="pagination"
    [currentPage]="currentPage"
    (pageChange)="onPageChange($event)"
  ></app-generic-pagination>
</div>

<app-generic-modal></app-generic-modal>

<app-warehouse-inventory-item-edit-modal
  *ngIf="warehouseInventoryId"
  [warehouseInventoryId]="warehouseInventoryId"
  (onSave)="handleInventoryItemSave($event)"
  (onClose)="handleInventoryItemClose()"
></app-warehouse-inventory-item-edit-modal>
